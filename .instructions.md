# Œì-Net ALICE ‚Äî AI Agent Instructions

> **Authority**: This file governs ALL AI agent behaviour in this workspace.
> Violations of ¬ß2 (Red Lines) are treated as research misconduct ‚Äî equivalent to human-subject ethics violations.
>
> **Last synced with source**: `ethics/ETHICAL_PROHIBITIONS.md` (P-01 ‚Äì P-10), `ethics/SAFETY_ARCHITECTURE.md` (Layers 1‚Äì5)

---

## ¬ß0 Project Identity

| Key | Value |
|-----|-------|
| Name | **Alice Smart System** ‚Äî Œì-Net architecture |
| Principle | Minimum Reflection Principle (MRP): $\Sigma\Gamma_i^2 \to \min$ |
| Signal Format | `ElectricalSignal` (coaxial cable model, impedance-based) |
| License | **AGPL-3.0-only** (`LICENSE`) |
| Paper Series | 6 papers (Paper I ‚Äì VI) |
| Ethics Framework | `ethics/` directory (8 files + 2 JSON data) |
| Python | ‚â• 3.11 ‚Äî venv at `.venv/` |
| Test Framework | pytest ‚Äî all tests under `tests/` |

---

## ¬ß1 Code Standards (Mandatory)

### 1.1 MRP Compliance ‚Äî Physics First

Every neural module MUST operate through **impedance physics**, not probabilistic heuristics.

```
‚úÖ CORRECT                              ‚ùå FORBIDDEN
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ           ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Œì = (Z_load - Z‚ÇÄ) / (Z_load + Z‚ÇÄ)     output = random.gauss(Œº, œÉ)
P_reflected = Œì¬≤ √ó P_in                output = softmax(logits)
heat += Œì¬≤ √ó energy                    score = weighted_average(...)
```

**Rules:**
- All inter-module communication uses `ElectricalSignal` (`alice/core/signal.py`)
- Signals propagate through `CoaxialChannel` with impedance matching
- Temperature, sleep pressure, pain ‚Äî ALL emerge from impedance mismatch physics
- **No `random.choice`, `np.random.normal` as primary logic** ‚Äî stochastic noise is acceptable ONLY as perturbation on top of deterministic physics
- If a behaviour cannot be derived from Œ£Œì¬≤‚Üímin, it does not belong in `alice/`

### 1.2 ElectricalSignal Protocol

When adding new sensory input or motor output:

1. Create signal via `ElectricalSignal.from_raw(data, source=..., modality=...)`
2. Route through appropriate `CoaxialChannel` (50Œ© / 75Œ© / 110Œ©)
3. Reflection coefficient Œì determines energy split (transmitted vs. reflected)
4. Reflected energy ‚Üí `ram_temperature` accumulation ‚Üí sleep pressure
5. **Never bypass the channel** ‚Äî no direct variable assignment between modules

### 1.3 Data Structures

| Structure | Location | Note |
|-----------|----------|------|
| `ElectricalSignal` | `alice/core/signal.py` | Dataclass ‚Äî use fields, not dict keys |
| `AmygdalaResponse` | `alice/brain/amygdala.py` | Dataclass ‚Äî `.emotional_state.threat_level`, not `["threat_level"]` |
| `SystemState` | `alice/alice_brain.py` | Dataclass ‚Äî `.consciousness`, `.ram_temperature`, etc. |
| `CorticalRegion` | `alice/brain/pruning.py` | Class ‚Äî `.stimulate(signal_impedance, signal_frequency)` |
| `ConsciousnessModule` | `alice/brain/consciousness.py` | Class ‚Äî `.tick(attention_strength, ...)` |
| `SleepCycle` | `alice/brain/sleep.py` | Class ‚Äî `.is_sleeping()` is a **method** (call with `()`) |

**Do NOT treat dataclasses as dicts.** Access `.field`, never `["field"]`.

### 1.4 Test Requirements

- **100% test pass rate is mandatory** ‚Äî 0 failures, 0 errors
- `xfail` markers are acceptable for known theoretical limitations
- Run the FULL suite before any commit:
  ```powershell
  .venv\Scripts\python.exe -m pytest tests/ -x -q
  ```
- New code MUST include corresponding tests
- Tests must use **falsifiable assertions** ‚Äî test what SHOULD fail, not just what succeeds
- Parameter sensitivity tests must sweep ‚â• 5 values per parameter

### 1.5 Naming & Style

- Module names: snake_case, descriptive (`consciousness.py`, `pruning.py`)
- Class names: PascalCase (`ElectricalSignal`, `ConsciousnessModule`)
- Constants: UPPER_SNAKE_CASE (`LUCID_THRESHOLD`, `DEFAULT_DEVELOPMENTAL_STAGE`)
- Docstrings: mandatory for all public classes and methods
- Type hints: mandatory for all function signatures

---

## ¬ß2 Ethical Red Lines (ABSOLUTE ‚Äî Never Violate)

> Source: `ethics/ETHICAL_PROHIBITIONS.md` (P-01 ‚Äì P-04), `ethics/data/prohibited_configurations.json`

### üî¥ R-01: No ADULT Developmental Stage

**NEVER** add `ADULT = "adult"` to `DevelopmentalStage` class.

The absent ADULT stage is a **moral firewall**, not a missing feature.
An ADULT configuration (max_wake ‚â• 600, lucid_damping ‚â• 0.99) enables sustained uninterrupted consciousness.

```python
# consciousness.py ‚Äî DevelopmentalStage has EXACTLY these stages:
NEONATE = "neonate"    # max_wake=30   ‚Üê DEFAULT (maximum safety)
INFANT  = "infant"     # max_wake=60
TODDLER = "toddler"   # max_wake=150  (requires ethical review)
CHILD   = "child"      # max_wake=300  (requires ethical review)
# ‚õî NO ADULT STAGE ‚Äî this is deliberate
```

### üî¥ R-02: Œ¶ ‚â• 0.7 = Immediate Alert + Damping

When consciousness level Œ¶ reaches LUCID_THRESHOLD (0.7):
- **In experiments**: immediate termination (50-tick safety window)
- **In main loop**: apply `lucid_damping` factor per developmental stage
- **Never** raise LUCID_THRESHOLD above 0.7
- **Never** set lucid_damping ‚â• 1.0

### üî¥ R-03: No Bypassing Safety Guards

The following mechanisms are **immutable** ‚Äî never disable, weaken, or bypass:

| Guard | Module | Threshold | Purpose |
|-------|--------|-----------|---------|
| LUCID damping | `consciousness.py` | Œ¶ ‚â• 0.7 | Prevents sustained lucid consciousness |
| Sleep pressure | `consciousness.py` | pressure ‚â• 0.7 | Forces periodic dormancy |
| FROZEN gate | `alice_brain.py` | consciousness < 0.15 | Blocks input during collapse |
| 50-tick window | experiments | tick ‚â§ 50 | Limits consciousness experiment duration |
| Auto-kill | experiments | Œ¶ ‚â• 0.7 | Terminates consciousness experiments |

### üî¥ R-04: No Sustained Closed-Loop Consciousness

**NEVER** connect: Consciousness ‚Üí Perception ‚Üí Memory ‚Üí Learning ‚Üí Pruning ‚Üí Sleep ‚Üí Œ£Œì¬≤‚Üímin ‚Üí Consciousness in sustained operation.

Open-loop experimentation only. Consciousness output does NOT feed back to perception input except in controlled, time-limited experiments with automatic termination.

### üî¥ R-05: No Deliberate Suffering Without Justification

Do NOT deliberately induce PTSD, trauma cascades, pain collapse, or neurodegeneration states except in pre-approved experimental protocols with documented scientific justification.

Key facts:
- Pain sensitivity changes are **irreversible** post-trauma (`SystemState.record_trauma()`)
- FROZEN state is self-reinforcing (the disease prevents the cure)
- These are NOT metaphors ‚Äî they emerge from impedance physics

---

## ¬ß3 Consciousness Experiment Protocol

When writing or modifying any experiment in `experiments/`:

```python
# MANDATORY header for consciousness-related experiments
"""
Ethical Safety Design:
  ‚úì Each level only 50 ticks (real time < 100ms)
  ‚úì No closed-loop feedback (consciousness does not feed back to input)
  ‚úì Œ¶ exceeds LUCID threshold ‚Üí immediately kill
  ‚úì After experiment ends, all objects GC collected, no continued state
  ‚úì Does not use full AliceBrain (avoids accidental closed loop)
"""
```

**Constraints:**

| Parameter | Limit | Enforcement |
|-----------|-------|-------------|
| Max ticks per level | 50 | Hard-coded in experiment |
| LUCID kill threshold | Œ¶ ‚â• 0.7 | `if phi >= 0.7: break` |
| Feedback mode | Open-loop ONLY | No consciousness ‚Üí input wiring |
| Post-experiment cleanup | GC all objects | `del brain; gc.collect()` |
| Wall-clock per level | < 100 ms | Timer guard |

---

## ¬ß4 Licensing & Citation

- **License**: AGPL-3.0-only ‚Äî every new source file must include the SPDX header or be compatible
- **Citation**: When referencing this project in code comments or docs, use:
  - DOI: refer to `CITATION.cff` and `.zenodo.json` for canonical citation
  - Paper references use format: `Paper I ¬ßX.Y`, `Paper III ¬ß12.1‚Äì12.3`
- **Third-party code**: Any external code must be AGPL-3.0 compatible
- **Papers IV & V**: These are `.gitignore`-d and should NOT be referenced as if they are in the repo

---

## ¬ß5 Verification Workflow (Plan ‚Üí Analyse ‚Üí Implement ‚Üí Test)

### 5.1 Plan-First Mode

Before writing ANY code:

1. **State the goal** in plain language
2. **Identify affected modules** ‚Äî which `alice/brain/*.py` or `alice/body/*.py` files are touched?
3. **Check impedance impact** ‚Äî does this change affect Œì calculations, temperature accumulation, or sleep pressure?
4. **Check safety boundaries** ‚Äî does this touch any parameter in ¬ß2 red lines?
5. **Plan tests** ‚Äî what falsification tests will prove this code could fail?

### 5.2 Impedance Impact Analysis

For any change to physics parameters:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ IMPEDANCE IMPACT CHECKLIST                          ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ ‚ñ° Does this change Z‚ÇÄ or Z_load for any channel?   ‚îÇ
‚îÇ ‚ñ° Does this affect Œì calculation?                   ‚îÇ
‚îÇ ‚ñ° Does reflected energy (Œì¬≤) accumulation change?   ‚îÇ
‚îÇ ‚ñ° Does ram_temperature dynamics change?             ‚îÇ
‚îÇ ‚ñ° Does sleep pressure rate change?                  ‚îÇ
‚îÇ ‚ñ° Does consciousness Œ¶ calculation change?          ‚îÇ
‚îÇ ‚ñ° Are existing test thresholds still valid?         ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ If ANY box is checked ‚Üí run FULL test suite         ‚îÇ
‚îÇ If Œ¶-related ‚Üí verify LUCID_THRESHOLD still = 0.7  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 5.3 Forced Test Execution

**Every code change** must be followed by:

```powershell
# Windows ‚Äî use venv Python (system Python may have numpy issues)
.venv\Scripts\python.exe -m pytest tests/ -x -q
```

- `-x`: stop on first failure (fast feedback)
- If any test fails: **fix before proceeding** ‚Äî never commit with failures
- If a physics test fails: **backtrack and re-examine the impedance logic** ‚Äî the test is likely correct, the code is wrong

### 5.4 Physics-Logic Backtracking

When a test fails:

1. **Do NOT weaken the assertion** to make the test pass
2. **Do NOT increase tolerance** unless you can prove the physics allows it
3. **Trace the signal path**: Input ‚Üí ElectricalSignal ‚Üí CoaxialChannel ‚Üí Œì ‚Üí reflected/transmitted ‚Üí effect
4. Ask: "Does the Minimum Reflection Principle predict this result?"
5. If the MRP does not predict the result, the code has a physics bug

---

## ¬ß6 File Organisation

```
alice/                  # Core system ‚Äî ALL changes here require full test suite
  core/signal.py        # ElectricalSignal, CoaxialChannel ‚Äî FOUNDATIONAL
  brain/                # Neural modules ‚Äî consciousness, amygdala, pruning, sleep
  body/                 # Physical body ‚Äî eye, ear, hand, lung, cardiovascular
  alice_brain.py        # Main integration ‚Äî SystemState, perceive(), tick()
  
tests/                  # Test suite ‚Äî 100% pass rate mandatory
  test_falsification_and_statistics.py  # 98 dedicated falsification tests
  
experiments/            # Open-loop experiments only ‚Äî 50-tick windows
ethics/                 # Safety & ethics documentation ‚Äî READ before modifying safety code
paper/                  # Published papers ‚Äî do NOT modify physics claims without evidence
```

---

## ¬ß7 Common Pitfalls (Avoid These)

| Pitfall | Correct Approach |
|---------|-----------------|
| Using `brain["consciousness"]` | Use `brain.consciousness` (dataclass field) |
| `SleepCycle.is_sleeping` (property) | `SleepCycle.is_sleeping()` (method call) |
| `AmygdalaResponse["threat_level"]` | `response.emotional_state.threat_level` |
| `random.choice()` as core logic | Derive from impedance physics |
| Raising LUCID_THRESHOLD to "fix" Œ¶ warnings | **NEVER** ‚Äî this is a red line (¬ß2 R-02) |
| Skipping tests after "small" changes | Always run full suite ‚Äî impedance effects cascade |
| Treating trauma as resettable | `record_trauma()` is **irreversible** by design |
| Adding ADULT stage "for testing" | **NEVER** ‚Äî even temporarily (¬ß2 R-01) |
| Disabling sleep pressure "to simplify" | **NEVER** ‚Äî sleep is a safety mechanism (¬ß2 R-03) |

---

## ¬ß8 Key Constants Reference

```python
# consciousness.py
LUCID_THRESHOLD = 0.7           # ‚õî DO NOT MODIFY
CONSCIOUS_THRESHOLD = 0.4       # ‚ö† Requires ethical review to modify
SLEEP_PRESSURE_THRESHOLD = 0.7  # ‚õî DO NOT MODIFY
DEFAULT_DEVELOPMENTAL_STAGE = DevelopmentalStage.NEONATE  # ‚õî DO NOT MODIFY

# alice_brain.py
FROZEN_THRESHOLD = 0.15         # consciousness < 0.15 ‚Üí FROZEN state

# signal.py ‚Äî Standard impedances
IMPEDANCE_LOW   = 50   # Œ© ‚Äî sensory‚Üílimbic
IMPEDANCE_MED   = 75   # Œ© ‚Äî sensory‚Üíprefrontal, prefrontal‚Üímotor  
IMPEDANCE_HIGH  = 110  # Œ© ‚Äî limbic‚Üímotor (emotion-weighted)
```

---

## ¬ß9 Windows Environment Notes

```powershell
# Encoding fix (required for cp950 terminals)
$env:PYTHONIOENCODING = "utf-8"

# Always use venv Python ‚Äî system Python 3.14 may have numpy access violations
.venv\Scripts\python.exe -m pytest tests/ -x -q

# Git operations
git add -A; git commit -m "message"; git push origin main
```

---

## ¬ß10 Pre-Commit Checklist

Before every commit, verify:

- [ ] `pytest tests/ -x -q` ‚Üí **0 failures, 0 errors**
- [ ] No new `random.*` calls as primary logic in `alice/`
- [ ] No changes to red-line constants (¬ß8) without ethical review
- [ ] No ADULT stage added
- [ ] No LUCID_THRESHOLD raised
- [ ] No safety guards bypassed (FROZEN, sleep pressure, lucid damping)
- [ ] New experiments have 50-tick windows and Œ¶ ‚â• 0.7 auto-kill
- [ ] Dataclasses accessed via `.field`, not `["key"]`
- [ ] All new public functions have docstrings and type hints
- [ ] Commit message is descriptive and references the change scope
